<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Chat</title>
</head>
<body>
<div th:insert="fragments/header :: *"></div>
<h2>Chat</h2>
<div id="chat">
    <ul id="messages"></ul>
</div>
<input id="from" placeholder="Your name" />
<input id="text" placeholder="Message" />
<button id="send">Send</button>
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
<script>
    var socket = new SockJS('/ws');
    var stompClient = Stomp.over(socket);
    stompClient.connect({}, function(frame) {
        stompClient.subscribe('/topic/messages', function(message){
            var body = JSON.parse(message.body);
            var li = document.createElement('li');
            li.appendChild(document.createTextNode(body.from + ': ' + body.text));
            document.getElementById('messages').appendChild(li);
        });
    });
    document.getElementById('send').addEventListener('click', function(){
        var from = document.getElementById('from').value;
        var text = document.getElementById('text').value;
        stompClient.send('/app/chat.send', {}, JSON.stringify({from: from, text: text}));
    });
</script>
<div th:insert="fragments/footer :: *"></div>
</body>
</html>